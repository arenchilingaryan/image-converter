docker-build:
    image: docker:latest
    stage: build
    services:
      - docker:dind
    before_script:
      - docker login -u "$GITHUB_EVENT_NAME" -p $GITHUB_WORKFLOW
    script:
      - docker build --pull -t "$CI_REGISTRY_IMAGE:latest" .
      - docker push "$CI_REGISTRY_IMAGE:latest"
  # Run this job in a branch where a Dockerfile exists
    rules:
      - if: $CI_COMMIT_BRANCH
        exists:
          - Dockerfile